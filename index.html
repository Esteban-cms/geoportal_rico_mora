<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Geoportal ‚Äì Rico Mora S.A.S.</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html, body { height:100%; margin:0; font-family:"Segoe UI", Arial, sans-serif; }
#sidebar {
  position: fixed; top:0; left:0; width:310px; height:100%; background:#111;
  padding:15px; overflow-y:auto; color:white; z-index:1000;
}
#sidebar img { display:block; margin:auto; width:110px; border-radius:8px; }
#sidebar h2 { color:#00e676; text-align:center; margin-bottom:10px; }
.section { background:#1b1b1b; padding:10px; border-radius:8px; margin-top:12px; }
#map-container { margin-left:310px; height:100%; }
.map-buttons { position:fixed; top:15px; right:15px; z-index:1500; }
.map-btn { background:#2f2f2f; width:44px; height:44px; border-radius:50%; display:flex; justify-content:center; align-items:center; cursor:pointer; color:white; font-size:20px;}
.map-btn:hover { background:#4a4a4a;}
.legend { background:white; padding:8px; border-radius:8px; line-height:1.4; font-size:12px; }
.cross-marker { text-align:center; }
</style>
</head>
<body>

<div id="sidebar">
  <img src="logo.png.png" alt="Rico Mora">
  <h2>Geoportal Corporativo</h2>

  <div class="section"><b>üìç Proyecto</b><br>Cantera Malabrigo</div>
  <div class="section"><b>üè¢ Empresa</b><br>Rico Mora S.A.S.</div>
  <div class="section"><b>‚ÑπÔ∏è Informaci√≥n</b><br>Visor geogr√°fico con capas y consultas.</div>

  <div class="section" id="feature-info"><b>üí° Seleccione un elemento</b></div>

  <div class="section" id="layer-control"><b>üóÇ Capas</b><br></div>
</div>

<div id="map-container"></div>

<div class="map-buttons">
  <div class="map-btn" id="home-btn">üè†</div>
</div>

<div id="legend" class="legend" style="position:fixed; bottom:10px; right:10px; z-index:1500;"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// üåé Crear mapa centrado en coordenadas y escala deseada
var map = L.map('map-container').setView([6.7416619,-74.7291713],18);

// üîπ Capas base
var googleSat = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', { attribution:'Google Satelital' }).addTo(map);
var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'¬© OpenStreetMap' });

var baseMaps = { "Sat√©lite (Google)": googleSat, "Calles (OSM)": osm };
var overlays = {};
var layerControl = L.control.layers(baseMaps, overlays, {collapsed:false, position:'topright'}).addTo(map);

// Desplazamos el control de capas para que no tape el bot√≥n
document.querySelector('.leaflet-control-layers').style.top = '70px';

// üìÅ Archivos GeoJSON
var geojsonFiles = [
  "Concesi√≥n IH8-10541.geojson",
  "Drenaje_Sencillo.geojson",
  "Frentes de explotaci√≥n del proyecto Rico Mora.geojson",
  "Infraestructura Existente.geojson",
  "Obras_sin_permiso_cauce.geojson",
  "Ocupaci√≥n de Cauce.geojson",
  "Q. Malabrigo.geojson",
  "Veredas de influencia del proyecto.geojson",
  "V√≠a.geojson"
];

// Estilos y tipos
var layerStyles = {
  "Concesi√≥n IH8-10541.geojson": {color:"#e41a1c", type:"polygon"},
  "Drenaje_Sencillo.geojson": {color:"#377eb8", type:"line", weight:2, defaultVisible:false},
  "Frentes de explotaci√≥n del proyecto Rico Mora.geojson": {color:"#4daf4a", type:"cross"},
  "Infraestructura Existente.geojson": {color:"#ffff00", type:"marker", radius:4, innerColor:"#000"},
  "Obras_sin_permiso_cauce.geojson": {color:"red", type:"marker"},
  "Ocupaci√≥n de Cauce.geojson": {color:"blue", type:"marker"},
  "Q. Malabrigo.geojson": {color:"#1f78b4", type:"polygon"},
  "Veredas de influencia del proyecto.geojson": {color:"#888888", type:"polygon", opacity:0.4, defaultVisible:false},
  "V√≠a.geojson": {color:"#999999", type:"line-double", weight:3}
};

var layers = {};

function onEachFeature(feature, layer){
  layer.on('click', function(){
    let info = "<b>"+(feature.properties.nombre||"Elemento")+"</b><br>";
    for(let key in feature.properties){ info += "<b>"+key+":</b> "+feature.properties[key]+"<br>"; }
    document.getElementById('feature-info').innerHTML = info;
  });
}

// Crear capa seg√∫n tipo
function createLayer(file, data){
  let style = layerStyles[file] || {color:"#000", type:"polygon"};
  let layer;

  if(style.type==="cross"){
    layer = L.geoJSON(data,{
      pointToLayer: function(f, latlng){
        return L.marker(latlng,{
          icon:L.divIcon({className:'cross-marker', html:'<div style="color:'+style.color+'; font-size:18px;">&#10006;</div>', iconSize:[18,18]})
        });
      },
      onEachFeature:onEachFeature
    });
  } else if(style.type==="marker"){
    let iconUrl = "";
    if(file.includes("Ocupaci√≥n")) iconUrl = "https://cdn-icons-png.flaticon.com/512/684/684908.png";
    else if(file.includes("Obras_sin_permiso")) iconUrl = "https://cdn-icons-png.flaticon.com/512/484/484167.png";
    layer = L.geoJSON(data,{
      pointToLayer: function(f, latlng){
        if(file==="Infraestructura Existente.geojson"){
          return L.circleMarker(latlng,{
            radius:style.radius,
            color:style.color,
            fillColor:style.innerColor,
            fillOpacity:1,
            weight:1
          });
        } else {
          return L.marker(latlng,{icon:L.icon({iconUrl:iconUrl, iconSize:[20,20]})});
        }
      },
      onEachFeature:onEachFeature
    });
  } else if(style.type==="line-double"){
    let l1 = L.geoJSON(data,{style:{color:style.color, weight:style.weight||3}, onEachFeature:onEachFeature});
    let l2 = L.geoJSON(data,{style:{color:"#fff", weight:(style.weight||3)-1}});
    layer = L.layerGroup([l1,l2]);
  } else if(style.type==="line"){
    layer = L.geoJSON(data,{style:{color:style.color, weight:style.weight||2}, onEachFeature:onEachFeature});
  } else {
    layer = L.geoJSON(data,{style:{color:style.color, fillColor:style.color, fillOpacity:style.opacity||0.4}, onEachFeature:onEachFeature});
  }

  return layer;
}

// Cargar capas GeoJSON
geojsonFiles.forEach(file=>{
  fetch(file).then(r=>r.json()).then(data=>{
    let layer = createLayer(file,data);

    // Veredas y Drenaje desactivados por defecto
    if(layerStyles[file].defaultVisible!==false) layer.addTo(map);

    layers[file] = layer;

    // Checkboxes en sidebar
    let lc = document.createElement('div');
    lc.innerHTML = `<input type="checkbox" id="${file}" ${layerStyles[file].defaultVisible!==false ? 'checked':''}> ${file}`;
    lc.querySelector('input').addEventListener('change', e=>{
      if(e.target.checked) map.addLayer(layers[file]);
      else map.removeLayer(layers[file]);
    });
    document.getElementById('layer-control').appendChild(lc);
  }).catch(err=>console.log("Error "+file,err));
});

// Bot√≥n Home
document.getElementById('home-btn').onclick = ()=>{ map.setView([6.7416619,-74.7291713],18); };

// Leyenda
var legend = document.getElementById('legend');
legend.innerHTML = `
<b>Leyenda</b><br>
Frentes de explotaci√≥n: X verde<br>
Ocupaci√≥n de Cauce: marcador azul<br>
Obras sin permiso: marcador rojo<br>
Infraestructura Existente: puntos amarillos peque√±os con centro negro<br>
Q. Malabrigo: pol√≠gonos azul<br>
Veredas de influencia: pol√≠gonos gris opaco (desactivada)<br>
Fuentes h√≠dricas: l√≠nea azul delgada<br>
V√≠as: doble l√≠nea gris<br>
Drenaje: l√≠nea azul (desactivada por defecto)
`;
</script>

</body>
</html>
