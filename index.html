<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Geoportal â€“ Rico Mora S.A.S.</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

<style>
html, body { height: 100%; margin: 0; font-family: "Segoe UI", Arial, sans-serif; }
#sidebar {
  position: fixed; top: 0; left: 0; width: 310px; height: 100%;
  background: #111; padding: 15px; overflow-y: auto; color: white; z-index: 1000;
}
#sidebar img { display: block; margin: auto; width: 110px; border-radius: 8px; }
.section { background: #1b1b1b; padding: 10px; border-radius: 8px; margin-top: 12px; }
#map-container { margin-left: 310px; height: 100%; }
.map-buttons { position: fixed; top: 15px; right: 15px; display: flex; flex-direction: column; gap: 10px; z-index: 1500; }
.map-btn { background: #2f2f2f; width: 44px; height: 44px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; color: white; font-size: 20px; }
.map-btn:hover { background: #4a4a4a; }
</style>
</head>
<body>

<div id="sidebar">
  <img src="logo.png.png" alt="Rico Mora">
  <h2>Geoportal Corporativo</h2>

  <div class="section"><b>ğŸ“ Proyecto</b><br>Cantera Malabrigo</div>
  <div class="section"><b>ğŸ¢ Empresa</b><br>Rico Mora S.A.S.</div>
  <div class="section">
    <b>â„¹ï¸ InformaciÃ³n</b><br>
    Visor geogrÃ¡fico con capas y consultas.
  </div>

  <div class="section" id="feature-info">
    <b>ğŸ’¡ Seleccione un elemento</b>
  </div>
</div>

<div id="map-container"></div>

<div class="map-buttons">
  <div class="map-btn" id="home-btn">ğŸ </div>
  <div class="map-btn" id="coords-btn">ğŸ“</div>
  <div class="map-btn" id="locate-btn">ğŸ§­</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>

<script>
// âœ¨ Crear mapa
var map = L.map('map-container').setView([6.5, -75.5], 12);

// ğŸ”¹ Capas base
var googleSat = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
    attribution: 'Google Satelital'
}).addTo(map);

var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap'
});

var baseMaps = {
    "SatÃ©lite (Google)": googleSat,
    "Calles (OSM)": osm
};

var overlays = {};
L.control.layers(baseMaps, overlays, {collapsed:false, position:'topright'}).addTo(map);

// ğŸ§­ Mi ubicaciÃ³n
L.control.locate({position: 'topright'}).addTo(map);

// ğŸ“ Botones
document.getElementById('home-btn').onclick = ()=>{
    map.setView([6.5, -75.5], 12);
};
document.getElementById('coords-btn').onclick = ()=>{
    map.once('click', e=>{
        alert("Coordenadas:\nLat: "+e.latlng.lat.toFixed(6)+"\nLng: "+e.latlng.lng.toFixed(6));
    });
    alert("Cliquea en el mapa para ver coordenadas.");
};

// ğŸ“ GeoJSON archivos
var geojsonFiles = [
  "ConcesiÃ³n IH8-10541.geojson",
  "Drenaje_Sencillo.geojson",
  "Frentes de explotaciÃ³n del proyecto Rico Mora.geojson",
  "Infraestructura Existente.geojson",
  "Obras_sin_permiso_cauce.geojson",
  "OcupaciÃ³n de Cauce.geojson",
  "Q. Malabrigo.geojson",
  "Veredas de influencia del proyecto.geojson",
  "VÃ­a.geojson"
];

// ğŸ¨ Colores por capa
var layerColors = {
  "ConcesiÃ³n IH8-10541.geojson": "#e41a1c",
  "Drenaje_Sencillo.geojson": "#377eb8",
  "Frentes de explotaciÃ³n del proyecto Rico Mora.geojson": "#4daf4a",
  "Infraestructura Existente.geojson": "#984ea3",
  "Obras_sin_permiso_cauce.geojson": "#ff7f00",
  "OcupaciÃ³n de Cauce.geojson": "#ffff33",
  "Q. Malabrigo.geojson": "#a65628",
  "Veredas de influencia del proyecto.geojson": "#f781bf",
  "VÃ­a.geojson": "#999999"
};

// ğŸ§± Cargar y estilizar GeoJSON
geojsonFiles.forEach(file => {
    fetch(file)
      .then(res => res.json())
      .then(data => {
        var color = layerColors[file] || "#000000";

        var layer = L.geoJSON(data, {
          // ğŸ‘‡ si es punto
          pointToLayer: function(feature, latlng) {
            return L.circleMarker(latlng, {
              radius: 7,
              fillColor: color,
              color: "#000",
              weight: 1,
              fillOpacity: 0.8
            });
          },
          // ğŸ‘‡ estilo para lÃ­neas y polÃ­gonos
          style: function(feature){
            return {
              color: color,
              weight: 3,
              fillColor: color,
              fillOpacity: 0.4
            };
          },
          onEachFeature: function(feature, layer) {
            layer.on('click', function() {
              let info = "<b>" + (feature.properties.nombre || "Elemento") + "</b><br>";
              for(let key in feature.properties) {
                info += "<b>" + key + ":</b> " + feature.properties[key] + "<br>";
              }
              document.getElementById('feature-info').innerHTML = info;
            });
          }
        }).addTo(map);

        overlays[file] = layer; // agrega al control
      })
      .catch(err => console.log("Error cargando "+file+": "+err));
});
</script>

</body>
</html>
